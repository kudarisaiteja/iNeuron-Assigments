USE DATABASE SAITEJAWINDOW;

CREATE  OR REPLACE TABLE PHONES (
NAME VARCHAR(30) NOT NULL,
 PHONE_NUMBER INT NOT NULL,
PRIMARY KEY(PHONE_NUMBER));
 
 CREATE OR REPLACE TABLE CALLS(
 ID INT NOT NULL,
 CALLER INT FOREIGN KEY REFERENCES PHONES(PHONE_NUMBER) ,
 CALLEE INT FOREIGN KEY REFERENCES PHONES(PHONE_NUMBER) ,
 DURATION INT NOT NULL,
   UNIQUE(ID)
 );
 
INSERT INTO PHONES(NAME,  PHONE_NUMBER ) VALUES ('JACK',1234);
INSERT INTO PHONES(NAME,  PHONE_NUMBER )  VALUES ('LEENA', 3333 );
INSERT INTO PHONES (NAME,  PHONE_NUMBER )  VALUES('MARK', 9999);
INSERT INTO PHONES (NAME,  PHONE_NUMBER )  VALUES('ANNA', 7582);


INSERT INTO CALLS (ID, CALLER,  CALLEE,  DURATION) VALUES(25, 1234, 7582, 8);
INSERT INTO CALLS (ID, CALLER,  CALLEE,  DURATION) VALUES(7, 9999, 7582, 1);
INSERT INTO CALLS (ID, CALLER,  CALLEE,  DURATION) VALUES(18, 9999, 3333, 4);
INSERT INTO CALLS (ID, CALLER,  CALLEE,  DURATION) VALUES(2, 7582, 3333, 3);
INSERT INTO CALLS (ID, CALLER,  CALLEE,  DURATION) VALUES(3, 3333, 1234, 1);
INSERT INTO CALLS (ID, CALLER,  CALLEE,  DURATION) VALUES(21, 3333, 1234, 1);

SELECT * FROM PHONES;
 
SELECT * FROM CALLS;
 
 --1ST QUERY
 
 select name from phones where phone_number in
       (select caller from (select caller, duration from calls union all select callee, duration from calls) 
        group by caller having sum(duration)>=10) order by name;
      
   

 ---SELECT * FROM PHONES WHERE PHONE_NUMBER IN (SELECT DISTINCT MIN(DURATION) FROM CALLER);
 

 
----2ND QUERY
 
 SELECT *,ROW_NUMBER() OVER(PARTITION BY PHONE_NUMBER ORDER BY NAME DESC) AS ROW_NUM ,
RANK() OVER(PARTITION BY PHONE_NUMBER ORDER BY NAME DESC) AS RANK_ROW
FROM PHONES;

SELECT *, MAX(DURATION)  OVER(PARTITION BY CALLER ORDER BY CALLEE DESC ) AS MAX_DURATION,
MIN(DURATION)  OVER(PARTITION BY CALLER ORDER BY CALLEE DESC ) AS MIN_DURATION,
SUM(DURATION)  OVER(PARTITION BY CALLER ORDER BY CALLEE DESC ) AS SUM_DURATION
FROM CALLS;


 //3 REQUIRED OUTPUT---OWN
 SELECT NAME FROM 
(SELECT DISTINCT P.NAME, SUM(C.DURATION) AS TOTAL_DURATION
 FROM PHONES P
 JOIN 
 CALLS C 
 WHERE P.PHONE_NUMBER IN (C.CALLER, C.CALLEE)
 GROUP BY 1 HAVING  TOTAL_DURATION <=10
 ORDER BY 1);
